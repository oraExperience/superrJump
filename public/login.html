<!DOCTYPE html>
<html class="light" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Superjump - Login</title>
<link rel="icon" type="image/png" href="/logo.png"/>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#f4c025",
                        "background-light": "#f8f8f5",
                        "background-dark": "#221e10",
                    },
                    fontFamily: {
                        "display": ["Lexend", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "1rem",
                        "lg": "2rem",
                        "xl": "3rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
        body {
            font-family: 'Lexend', sans-serif;
        }
    </style>
</head>
<body class="font-display">
<div class="relative flex min-h-screen w-full flex-col items-center justify-center bg-background-light dark:bg-background-dark p-4 md:p-6">
<div class="absolute inset-0 z-0 h-full w-full bg-cover bg-center bg-no-repeat" style="background-image: url('/visualisation2.png');">
</div>
<div class="relative z-10 flex w-full max-w-md flex-col items-center">
<div class="w-full rounded-lg bg-white dark:bg-background-dark p-6 md:p-8 lg:p-10 shadow-2xl">
    <div class="mb-4 md:mb-6 flex flex-col items-center">
        <div class="flex items-center">
            <img src="/logo.png" alt="SuperrJump Logo" class="h-12 w-12 md:h-16 md:w-16" />
            <h2 class="text-2xl md:text-3xl lg:text-4xl font-extrabold leading-tight tracking-tighter text-[#1c180d] dark:text-white">SuperrJump</h2>
</div>
<!-- <p class="mt-3 text-xl text-[#1c180d] dark:text-white/90">Your AI partner</p> -->
</div>
<h1 class="text-xl md:text-2xl font-extrabold text-[#1c180d] dark:text-white">Sign In</h1>
<!-- <p class="mt-2 text-base text-slate-500 dark:text-white/70">Welcome back! Please enter your details.</p> -->

<!-- Message banner for users -->
<div id="messageBanner" class="hidden mt-4 p-3 md:p-4 rounded-lg">
    <div class="flex items-start gap-3">
        <span id="messageIcon" class="material-symbols-outlined text-xl"></span>
        <div class="flex-1">
            <p id="messageTitle" class="text-sm md:text-base font-medium"></p>
            <p id="messageText" class="text-xs md:text-sm mt-1"></p>
        </div>
    </div>
</div>

<form class="mt-6 md:mt-8 flex flex-col gap-4 md:gap-6">
    <label class="flex flex-col">
        <p class="pb-2 text-xs md:text-sm font-medium leading-normal text-[#1c180d] dark:text-white/90">Email Address</p>
        <input class="form-input h-10 md:h-12 w-full rounded-md border border-slate-300 dark:border-primary/20 bg-white dark:bg-background-dark/50 px-3 md:px-4 text-sm md:text-base font-normal text-[#1c180d] dark:text-white placeholder:text-slate-400 dark:placeholder:text-white/40 focus:border-primary focus:outline-0 focus:ring-2 focus:ring-primary/50" placeholder="" type="email" value=""/>
</label>
<label class="flex flex-col">
    <p class="pb-2 text-xs md:text-sm font-medium leading-normal text-[#1c180d] dark:text-white/90">Password</p>
    <div class="relative flex w-full flex-1 items-stretch">
        <input id="passwordField" class="form-input h-10 md:h-12 w-full rounded-md border border-slate-300 dark:border-primary/20 bg-white dark:bg-background-dark/50 px-3 md:px-4 pr-10 md:pr-12 text-sm md:text-base font-normal text-[#1c180d] dark:text-white placeholder:text-slate-400 dark:placeholder:text-white/40 focus:border-primary focus:outline-0 focus:ring-2 focus:ring-primary/50" placeholder="" type="password" value=""/>
        <button type="button" onclick="togglePassword()" class="absolute right-2 md:right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 focus:outline-none">
            <span id="eyeIcon" class="material-symbols-outlined !text-xl md:!text-2xl">visibility</span>
</button>
</div>
</label>
<div class="mt-2 md:mt-4">
    <button class="flex h-10 md:h-12 w-full items-center justify-center rounded-md bg-primary px-4 md:px-6 text-sm md:text-base font-bold text-background-dark shadow-sm transition-transform hover:scale-[1.02] active:scale-[0.98]" type="submit">Sign In</button>
</div>
<div class="flex items-center justify-between">
    <a class="text-xs md:text-sm font-medium text-blue-600 hover:underline dark:text-blue-400" href="/forgot-password">Forgot Password?</a>
    <a class="text-xs md:text-sm font-medium text-blue-600 hover:underline dark:text-blue-400" href="/">Home</a>
</div>

<script>
// Toggle password visibility
function togglePassword() {
    const passwordField = document.getElementById('passwordField');
    const eyeIcon = document.getElementById('eyeIcon');
    
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
        eyeIcon.textContent = 'visibility_off';
    } else {
        passwordField.type = 'password';
        eyeIcon.textContent = 'visibility';
    }
}
</script>


</form>
</div>
</div>

<script>
// Check for messages
window.addEventListener('load', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const messageType = urlParams.get('message');
    const messageBanner = document.getElementById('messageBanner');
    const messageIcon = document.getElementById('messageIcon');
    const messageTitle = document.getElementById('messageTitle');
    const messageText = document.getElementById('messageText');
    
    if (messageType === 'already_registered') {
        messageBanner.className = 'mt-4 p-3 md:p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg';
        messageIcon.className = 'material-symbols-outlined text-blue-600 dark:text-blue-400 text-xl';
        messageIcon.textContent = 'info';
        messageTitle.className = 'text-sm md:text-base font-medium text-blue-800 dark:text-blue-300';
        messageTitle.textContent = 'This email is already registered';
        messageText.className = 'text-xs md:text-sm text-blue-600 dark:text-blue-400 mt-1';
        messageText.textContent = 'Please sign in with your credentials';
        messageBanner.classList.remove('hidden');
    } else if (messageType === 'trial_created') {
        messageBanner.className = 'mt-4 p-3 md:p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-lg';
        messageIcon.className = 'material-symbols-outlined text-green-600 dark:text-green-400 text-xl';
        messageIcon.textContent = 'check_circle';
        messageTitle.className = 'text-sm md:text-base font-medium text-green-800 dark:text-green-300';
        messageTitle.textContent = 'Trial Created! ðŸŽ‰';
        messageText.className = 'text-xs md:text-sm text-green-600 dark:text-green-400 mt-1';
        messageText.textContent = 'Check your email for your password to sign in.';
        messageBanner.classList.remove('hidden');
    }
    
    // Clear the URL parameter after showing message
    if (messageType) {
        window.history.replaceState({}, document.title, '/login');
    }
});

// Prevent forward navigation to authenticated pages without login
window.addEventListener('load', () => {
    // Clear session data when on login page
    sessionStorage.removeItem('token');
    sessionStorage.removeItem('user');
    
    // Disable browser back/forward cache to prevent cached authenticated pages
    window.history.pushState(null, null, window.location.href);
    window.addEventListener('popstate', () => {
        window.history.pushState(null, null, window.location.href);
    });
});

// Login form handling
const loginForm = document.querySelector('form');
const emailInput = document.querySelector('input[type="email"]');
const passwordInput = document.getElementById('passwordField');

// Add IDs and required attributes
loginForm.id = 'loginForm';
emailInput.id = 'email';
emailInput.name = 'email';
emailInput.required = true;
emailInput.placeholder = 'Enter your email';
passwordInput.name = 'password';
passwordInput.required = true;
passwordInput.placeholder = 'Enter your password';

// Add error message div
const errorDiv = document.createElement('div');
errorDiv.id = 'errorMessage';
errorDiv.className = 'hidden p-3 bg-red-100 border border-red-400 text-red-700 rounded-md text-sm mb-4';
loginForm.insertBefore(errorDiv, loginForm.firstChild);

loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = emailInput.value.trim();
    const password = passwordInput.value;
    
    // Clear previous error
    errorDiv.classList.add('hidden');
    
    // Disable button
    const submitBtn = loginForm.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.disabled = true;
    submitBtn.textContent = 'Signing in...';
    
    try {
        const response = await fetch('/api/users/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Store JWT token and user data in sessionStorage
            sessionStorage.setItem('token', data.token);
            sessionStorage.setItem('user', JSON.stringify(data.user));
            sessionStorage.setItem('fromLogin', 'true');
            
            // Replace current history entry to prevent back navigation to login
            window.location.replace('/dashboard');
        } else {
            // Show error message
            errorDiv.textContent = data.message || 'Login failed. Please try again.';
            errorDiv.classList.remove('hidden');
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
        }
    } catch (error) {
        console.error('Login error:', error);
        errorDiv.textContent = 'An error occurred. Please try again.';
        errorDiv.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
    }
});
</script>


</div>

</body></html>